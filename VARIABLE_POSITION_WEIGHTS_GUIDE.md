# ë³€ìˆ˜ ìœ„ì¹˜ë³„ ê°€ì¤‘ì¹˜ (Variable Position Weights) ì‚¬ìš© ê°€ì´ë“œ

## ðŸ“ ê°œìš”

AI clusteringì—ì„œ ì—¬ëŸ¬ ê°œì˜ ë³€ìˆ˜ë¥¼ ë¹„êµí•  ë•Œ, **ì²«ë²ˆì§¸ ë³€ìˆ˜ê°€ ì¤‘ìš”í•œì§€ ë‘ë²ˆì§¸ ë³€ìˆ˜ê°€ ì¤‘ìš”í•œì§€ë¥¼ ì„¤ì •**í•  ìˆ˜ ìžˆëŠ” ê¸°ëŠ¥ìž…ë‹ˆë‹¤.

ì˜ˆ: `('memory_addr', 'bus_id', 'clock_cycle')` ê°™ì€ ë³€ìˆ˜ tupleì—ì„œ
- ì²«ë²ˆì§¸(memory_addr)ê°€ ê°€ìž¥ ì¤‘ìš” â†’ 3ë°°
- ë‘ë²ˆì§¸(bus_id)ëŠ” ì¤‘ê°„ â†’ 2ë°°  
- ì„¸ë²ˆì§¸(clock_cycle)ëŠ” ëœ ì¤‘ìš” â†’ 1ë°°

## ðŸŽ¯ ì‚¬ìš© ë°©ë²•

### 1. ê¸°ë³¸ ì„¤ì • (tail_weights ì—†ì´)

```json
{
  "RULE_XXX": {
    "eps": 0.2,
    "tail_levels": 1,
    "variable_position_weights": [3, 1]
  }
}
```

**ì˜ë¯¸:**
- `tail_levels=1`: íŒ¨í„´ì˜ ë§ˆì§€ë§‰ 1ê°œ ë ˆë²¨ë§Œ ì¶”ì¶œ
- `variable_position_weights=[3, 1]`: ì¶”ì¶œëœ ë¶€ë¶„ì˜ ì²«ë²ˆì§¸ë¥¼ 3ë°°, ë‚˜ë¨¸ì§€ë¥¼ 1ë°°

### 2. tail_weightsì™€ í•¨ê»˜ ì‚¬ìš©

```json
{
  "RULE_XXX": {
    "eps": 0.2,
    "tail_levels": 2,
    "tail_weights": [2, 3],
    "variable_position_weights": [4, 1]
  }
}
```

**ë™ìž‘ ìˆœì„œ:**
1. `tail_levels=2`: íŒ¨í„´ì˜ ë§ˆì§€ë§‰ 2ê°œ ë ˆë²¨ ì¶”ì¶œ
2. `tail_weights=[2, 3]`: ê° ë ˆë²¨ì„ 2ë°°, 3ë°° ë°˜ë³µ
3. `variable_position_weights=[4, 1]`: ê²°ê³¼ì˜ ì²«ë²ˆì§¸ ë¶€ë¶„ì„ 4ë°°, ë‚˜ë¨¸ì§€ë¥¼ 1ë°°

## ðŸ’¡ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ë©”ëª¨ë¦¬ ì£¼ì†Œê°€ ê°€ìž¥ ì¤‘ìš”í•œ ê²½ìš°

```json
{
  "RULE_MEMORY_ACCESS": {
    "eps": 0.15,
    "tail_levels": 1,
    "tail_weights": [4],
    "variable_position_weights": [3],
    "description": "ë©”ëª¨ë¦¬ ì£¼ì†Œ(ë§ˆì§€ë§‰)ë¥¼ 4ë°°, ì²«ë²ˆì§¸ ë³€ìˆ˜ë¥¼ ì¶”ê°€ë¡œ 3ë°°"
  }
}
```

### ì˜ˆì‹œ 2: ì²«ë²ˆì§¸ ë³€ìˆ˜(bus_type)ë§Œ ì¤‘ìš”

```json
{
  "RULE_BUS_TRANSFER": {
    "eps": 0.2,
    "tail_levels": 1,
    "variable_position_weights": [5, 1, 1],
    "description": "ì²«ë²ˆì§¸ ë³€ìˆ˜(bus_type) 5ë°°, ë‚˜ë¨¸ì§€ 1ë°°"
  }
}
```

### ì˜ˆì‹œ 3: ê²½ë¡œì˜ ì—¬ëŸ¬ ë¶€ë¶„ì´ ëª¨ë‘ ì¤‘ìš” (ì ì§„ì  ê°•ì¡°)

```json
{
  "RULE_PATH_ROUTING": {
    "eps": 0.18,
    "tail_levels": 3,
    "tail_weights": [1, 2, 3],
    "variable_position_weights": [2, 3, 1],
    "description": "ê²½ë¡œì˜ ë§ˆì§€ë§‰ 3ë‹¨ê³„ë¥¼ ì¶”ì¶œ([1,2,3]), ê·¸ ì¤‘ ë‘ë²ˆì§¸ë¥¼ ì¶”ê°€ë¡œ ê°•ì¡°([2,3,1])"
  }
}
```

## âš™ï¸ íŒŒë¼ë¯¸í„° ì„¤ëª…

| íŒŒë¼ë¯¸í„° | íƒ€ìž… | ì„¤ëª… | ê¸°ë³¸ê°’ | ì˜ˆì‹œ |
|---------|------|------|-------|------|
| `variable_position_weights` | Array | ë³€ìˆ˜/ë¶€ë¶„ì˜ ìœ„ì¹˜ë³„ ê°€ì¤‘ì¹˜ | `null` | `[3, 2, 1]` |
| `tail_levels` | Integer | íŒ¨í„´ì˜ ë’·ë¶€ë¶„ ëª‡ ê°œ ë ˆë²¨ ì¶”ì¶œ | 1 | 2 |
| `tail_weights` | Array | ê° ë ˆë²¨ì˜ ê°€ì¤‘ì¹˜ | `null` | `[2, 3]` |
| `eps` | Float | DBSCAN ìž„ê³„ê°’ | 0.2 | 0.15 |

## ðŸ” ë™ìž‘ ì›ë¦¬

### Step 1: Tail ì¶”ì¶œ (tail_levels, tail_weights)
```
íŒ¨í„´: "BLK_CPU / A / B / C / mem_top_ABC"
tail_levels=2, tail_weights=[2, 1]

ê²°ê³¼: ["C", "C", "mem_top_ABC"]
```

### Step 2: ìœ„ì¹˜ë³„ ê°€ì¤‘ì¹˜ ì ìš© (variable_position_weights)
```
parts = ["C", "C", "mem_top_ABC"]
variable_position_weights = [3, 1]

- parts[0]="C" Ã— weight[0]=3 â†’ ["C", "C", "C"]
- parts[1]="C" Ã— weight[1]=1 â†’ ["C"]
- parts[2]="mem_top_ABC" Ã— weight[1]=1 â†’ ["mem_top_ABC"]

ìµœì¢…: "C C C C mem_top_ABC"
```

### Step 3: Embedding ìƒì„±
```
embedding_input = "{template} {weighted_tail}"

ì˜ˆ: "Rule_XYZ detected 'X' of 'Y' C C C C mem_top_ABC"
                              â†‘ ìœ„ì¹˜ë³„ ê°€ì¤‘ì¹˜ê°€ ì ìš©ë¨
```

## ðŸ“Š íš¨ê³¼ ë¹„êµ

### ì„¤ì • ì—†ìŒ
```json
{ "variable_position_weights": null }
```
ëª¨ë“  ë¶€ë¶„ì´ ë™ë“±í•˜ê²Œ ì·¨ê¸‰ â†’ ëœ ì •í™•í•œ clustering

### ì²«ë²ˆì§¸ ë³€ìˆ˜ ê°•ì¡°
```json
{ "variable_position_weights": [3, 1] }
```
ì²«ë²ˆì§¸ ë³€ìˆ˜ê°€ 3ë°° â†’ ì²«ë²ˆì§¸ ë³€ìˆ˜ê°€ ë¹„ìŠ·í•˜ë©´ ê°™ì€ ê·¸ë£¹ìœ¼ë¡œ ë³‘í•©

### ì ì§„ì  ê°•ì¡°
```json
{ "variable_position_weights": [4, 2, 1] }
```
ì²«ë²ˆì§¸ > ë‘ë²ˆì§¸ > ì„¸ë²ˆì§¸ â†’ ë³µí•©ì  ë¹„êµ ê°€ëŠ¥

## ðŸ§ª í…ŒìŠ¤íŠ¸

ë³€ìˆ˜ ìœ„ì¹˜ë³„ ê°€ì¤‘ì¹˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸:
```bash
python3 test_variable_weights.py
```

## âœ… ì£¼ì˜ì‚¬í•­

1. **ë¶€ì¡±í•œ ê°€ì¤‘ì¹˜ëŠ” ë§ˆì§€ë§‰ ê°’ ì‚¬ìš©**
   - `variable_position_weights=[3]`ì´ë©´ ëª¨ë“  ë¶€ë¶„ì— 3ì„ ì ìš©
   
2. **tail_weightsì™€ í•¨ê»˜ ì‚¬ìš© ì‹œ ìˆœì„œ**
   - tail_weights ë¨¼ì € ì ìš© â†’ ê²°ê³¼ ë¶€ë¶„ë“¤ ìƒì„±
   - variable_position_weightsëŠ” ìµœì¢… ë¶€ë¶„ ë¦¬ìŠ¤íŠ¸ì— ì ìš©

3. **ê³¼ë„í•œ ê°€ì¤‘ì¹˜ëŠ” embeddingì˜ ì™œê³¡ ê°€ëŠ¥**
   - 10 ì´ìƒì˜ ê°€ì¤‘ì¹˜ëŠ” embedding spaceì—ì„œ ê³¼ë„í•˜ê²Œ ê°•ì¡°ë  ìˆ˜ ìžˆìŒ
   - ê¶Œìž¥: 1~5 ë²”ìœ„

4. **ruleë³„ë¡œ ë‹¤ë¥´ê²Œ ì„¤ì • ê°€ëŠ¥**
   - ê° rule_idë§ˆë‹¤ ë‹¤ë¥¸ variable_position_weights ì„¤ì • ê°€ëŠ¥
   - ê¸°ë³¸ê°’(null)ìœ¼ë¡œ ëŒì•„ê°€ë ¤ë©´ nullë¡œ ì„¤ì •

## ðŸš€ ê¶Œìž¥ ì‹œìž‘ ê°’

| ì¤‘ìš”ë„ | variable_position_weights | ì„¤ëª… |
|-------|---------------------------|------|
| ê· ë“± | `null` | ëª¨ë“  ë¶€ë¶„ ë™ë“± |
| ì•½ê°„ ê°•ì¡° | `[2, 1]` | ì²«ë²ˆì§¸ 2ë°° |
| ì¤‘ê°„ ê°•ì¡° | `[3, 1]` | ì²«ë²ˆì§¸ 3ë°° |
| ê°•í•˜ê²Œ ê°•ì¡° | `[4, 1]` | ì²«ë²ˆì§¸ 4ë°° |
| ì ì§„ì  | `[3, 2, 1]` | ì²«>ë‘˜>ì…‹ |
